{:loop-demo-agent
 {:description "Demo agent showing the new loop construct for batch processing"
  :start :create-items
  :max-steps 50

  :tools
  {:create-sample-items
   {:fn examples.loop_demo_tools/create-sample-items}

   :process-item
   {:fn examples.loop_demo_tools/process-item}}

  :steps
  {:create-items
   {:tool :create-sample-items
    :args {:count 5}
    :next :loop-all-items}

   :loop-all-items
   {:loop-over [:obs :items]
    :loop-body :process-one-item
    :next :summarize}

   :process-one-item
   {:tool :process-item
    :args {:item "{{loop-item}}"}
    :next :done}  ; Return to loop

   :summarize
   {:prompt "Summarize the batch processing results:\n\nTotal items: {{last-obs.loop-count}}\nResults: {{last-obs.loop-results}}\n\nProvide a brief summary of what was accomplished."
    :next :done}}}

 :loop-with-llm-agent
 {:description "Demo showing loop with LLM analysis for each item"
  :start :fetch-data
  :max-steps 50

  :tools
  {:fetch-data
   {:fn 'examples.loop_demo_tools/fetch-data}}

  :steps
  {:fetch-data
   {:tool :fetch-data
    :next :analyze-all}

   :analyze-all
   {:loop-over [:obs :items]
    :loop-body :analyze-one
    :next :final-report}

   :analyze-one
   {:prompt "Analyze this issue ({{loop-index}} of {{loop-count}}):\n\nTitle: {{loop-item.title}}\nDescription: {{loop-item.description}}\n\nProvide:\n1. Severity (low/medium/high)\n2. Estimated effort (hours)\n3. Recommended action\n\nBe concise (2-3 sentences)."
    :next :done}

   :final-report
   {:prompt "Create a final summary report:\n\nTotal issues analyzed: {{last-obs.loop-count}}\n\nIndividual analyses:\n{{last-obs.loop-results}}\n\nProvide:\n1. Overall priority ranking\n2. Recommended order of execution\n3. Total estimated time"
    :next :done}}}}
