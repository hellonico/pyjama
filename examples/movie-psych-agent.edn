{:movie-psych
 {:description "Movie psychological analysis using external basic-tools"
  :start :rewrite
  :max-steps 5

  :inputs
  {:movie-query {:type "string" :required true}}

  :tools
  {:wiki-movie {:fn pyjama.tools.external/execute-clojure-tool
                :args {:git-url "https://github.com/hellonico/pyjama-tools.git"
                       :subdir "basic-tools"
                       :namespace "basic-tools.core"}}}

  :steps
  {:rewrite {:prompt "Looking for a movie title. Return a search query for: {{movie-query}}. Produce ONLY 3‚Äì5 words (title + year if known)."
             :next :search}

   :search {:tool :wiki-movie
            :args {:function "wiki-movie"
                   :params {:message "{{last-obs.text}}"
                            :lang "en"
                            :limit 5}}
            :next :analyze}

   :analyze {:prompt "You are a film psychologist. Using the following movie info, write a psychological analysis covering:
- Protagonist/antagonist motivations
- Core conflicts and defense mechanisms
- Attachment patterns
- Turning points
- Resolution

Keep it 6-10 bullet points, no spoilers beyond premise level.

MOVIE INFO:
{{last-obs.text}}"
             :stream true
             :next :report}

   :report {:prompt "üìΩÔ∏è **MOVIE PSYCHOLOGICAL ANALYSIS**

üé¨ Film: {{trace.search.obs.best.title}} ({{trace.search.obs.best.year}})
üîó Info: {{trace.search.obs.best.url}}

üé≠ Original Query: {{movie-query}}

üß† **PSYCHOLOGICAL ANALYSIS:**
{{last-obs.text}}

---
‚úÖ Analysis complete! The film explores deep psychological themes through its characters and narrative structure."
            :stream true
            :terminal? true}}}}